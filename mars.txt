using Microsoft.SqlServer.Server;
using System;
using System.Collections.Generic;
using System.Data.SqlTypes;
using System.Diagnostics;
using System.Linq;
using System.Net;
using System.Net.Http.Headers;
using System.Net.Mail;
using System.Runtime.InteropServices;
using System.Security.Authentication;
using System.Text;
using System.Threading.Tasks;

namespace ConsoleApp1
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Console.InputEncoding = Encoding.Unicode;
            Console.OutputEncoding = Encoding.Unicode;
            float[] userInventory = new float[3] {100, 0, 0};
            int userChoiceOperstion; 
            int distation = 100;
            int howEnergMinus = 1;
            int energInShop;
            int sandStone;
            bool shotrmeInDesereGoin = false;
            bool shopIsWork = true;
            int countForShop = 0;
            bool protectionFromRobbers = false;
            
            int trashChance;
            int trashCount;
            
            int speed = 1;
            int speedPrice = 2;
            int shotrmeInDesereEnding;
            Random rand = new Random();
            for (int i = 0; i < 100; i++)
            {
                Console.ForegroundColor = ConsoleColor.White;
                shopIsWork = true;
                if (userInventory[0] > 0 && distation > 0)
                {
                    Console.WriteLine("Нажмите Enter чтобы сделать ход");
                    Console.ReadKey();
                    Console.ForegroundColor = ConsoleColor.DarkGray;
                    Console.WriteLine($"Вы начали движение, за ход отнялась {howEnergMinus} энергия и вы проехали {speed} километр(ов)");
                    distation -= speed;
                    if (userInventory[2] > 2000)
                    {
                        howEnergMinus = 3;
                        userInventory[0] -= howEnergMinus;
                    }
                    else
                    {
                        howEnergMinus = 1;
                        userInventory[0] -= 1;
                    }
                    countForShop++;
                    if (countForShop % 5 == 0) //магазин
                    {
                        Console.ForegroundColor = ConsoleColor.Cyan;
                        Console.WriteLine($"Статистика: {userInventory[0]} = энергия/{distation} = километры/{userInventory[1]:F2} = деньги/{userInventory[2]} мусора");
                        Console.WriteLine("Вы наткнулись на магазин, здесь вы можете:\n1. обменять мусор на деньги\n2. купить новые колеса\n3. пополнить энергию" +
                            "\n4. купить защиту от грабителя, чтоб сохранить деньги, введите номер операции\n5. выход из магазина");
                        while (shopIsWork)
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            userChoiceOperstion = Convert.ToInt32(Console.ReadLine());
                            Console.ForegroundColor = ConsoleColor.Cyan;
                            switch (userChoiceOperstion)
                            {
                                case 1:
                                userInventory[1] += userInventory[2] / 100.0f;
                                    userInventory[2] = 0;
                                    Console.WriteLine($"у вас денег {userInventory[1]:F2}, введите номер операции: ");
                                    break;
                                case 2:
                                    if (userInventory[1] >= speedPrice)
                                    {
                                        Console.WriteLine($"Стоимость улучшения колёс = {speedPrice}");
                                        userInventory[1] -= speedPrice;
                                        speed += 2;
                                        speedPrice *= 2;
                                        Console.WriteLine($"у вас денег {userInventory[1]:F2}, введите номер операции: ");
                                    }
                                    else
                                    {
                                        Console.WriteLine("Недостаточно денег");
                                    }
                                    break;
                                case 3:
                                    if (userInventory[1] > 0)
                                    {
                                        energInShop = Convert.ToInt32(Console.ReadLine());
                                        if (energInShop > 0 && energInShop <= 5 && userInventory[1] >= energInShop)
                                        {
                                            Console.WriteLine($"Вы полнились на {energInShop} энергии");
                                            userInventory[0] += energInShop;
                                            userInventory[1] -= energInShop;
                                            Console.WriteLine($"у вас денег {userInventory[1]:F2}, введите номер операции: ");
                                        }
                                        else
                                        {
                                            Console.WriteLine("Недопустимое количетсво энергии или денег");
                                        }
                                    }
                                    else
                                    {
                                        Console.WriteLine("Недостаточно денег");
                                    }
                                    break;
                                case 4:
                                    Console.WriteLine($"у вас денег {userInventory[1]:F2}, можете выбрать операцию что хотите делать: ");
                                    if (userInventory[1] >= 10)
                                    {
                                        if (protectionFromRobbers == false)
                                        {
                                            Console.WriteLine("Вы решили купить защиту от бандита");
                                            userInventory[1] -= 10;
                                            protectionFromRobbers = true;
                                        }
                                        else
                                        {
                                            Console.WriteLine("Защита уже куплена");
                                        }
                                    }
                                    else
                                    {
                                        Console.WriteLine("Недостаточно денег");
                                    }
                                    break;
                                case 5:
                                    shopIsWork = false;
                                    break;
                                default:
                                    Console.ForegroundColor = ConsoleColor.Red;
                                    Console.WriteLine("Я такой команды не знаю!,введите номер операции");
                                    break;
                            }

                        }
                    }
                    Console.WriteLine($"Статистика: {userInventory[0]} = энергия/{distation} = километры/{userInventory[1]:F2} = деньги");
                    sandStone = rand.Next(0, 101);
                    if (sandStone >= 16 && sandStone <= 20)
                    {
                        Console.ForegroundColor = ConsoleColor.DarkRed;
                        Console.WriteLine("Вы наткнулись на грабителя!");
                        if (userInventory[1] > 5)
                        {
                            if (protectionFromRobbers == true)
                            {
                                Console.WriteLine("Но у вас есть защита! вы нечего не теряете, а бандит убегает в страхе");
                            }
                            else
                            {
                                Console.WriteLine("Вы не купили защиту, бандит украл 6 монет");
                                userInventory[1] -= 6;
                            }
                        }
                        else
                        {
                            Console.WriteLine("У вас не оказалось денег, бандит дает вам деньги, он вам сочуствует и даёт монетки");
                            userInventory[1] += 3;
                        }
                    }
                    if (sandStone >= 0 && sandStone <= 15) //буря
                    {
                        shotrmeInDesereGoin = true;
                        Console.ForegroundColor = ConsoleColor.Yellow;
                        Console.WriteLine("Буря началась!");
                        while (shotrmeInDesereGoin && userInventory[0] > 0)
                        {
                            Console.ReadKey();
                            Console.WriteLine("-2 энергии");
                            userInventory[0] -= 2;
                            shotrmeInDesereEnding = rand.Next(0, 5);

                            if (shotrmeInDesereEnding == 4)
                            {
                                Console.WriteLine("Буря закончилась");
                                shotrmeInDesereGoin = false;
                                Console.WriteLine($"Во время бури была потрачена энергия, оставшаяся энергия: {userInventory[0]}");
                                trashChance = rand.Next(1, 5);
                                if (trashChance == 4 || trashChance == 3)
                                {
                                    Console.WriteLine("Вы нашли немного космического мусора");
                                    trashCount = rand.Next(670, 1560);
                                    userInventory[2] += trashCount;
                                    Console.ForegroundColor = ConsoleColor.DarkYellow;
                                    Console.WriteLine($"Вы получили {trashCount} мусора/общее количетсво мусора = {userInventory[2]}");
                                }
                            }
                            else
                            {
                                Console.WriteLine("Буря продолжается");
                            }
                        }

                    }
                }
                else if (userInventory[0] <= 0)
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("Энергии нет!");
                    break;
                }
            }
            if (userInventory[0] <= 0)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("Поражение! Вы не доехали!");
            }
            else
            {
                Console.ForegroundColor = ConsoleColor.Yellow;
                Console.WriteLine("Победа! Вы доехали!");
            }
        }


    }
}

