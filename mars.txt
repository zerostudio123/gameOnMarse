using Microsoft.CSharp.RuntimeBinder;
using Microsoft.SqlServer.Server;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlTypes;
using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using System.Diagnostics.Eventing.Reader;
using System.Dynamic;
using System.Linq;
using System.Net;
using System.Net.Http.Headers;
using System.Net.Mail;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Runtime.Remoting.Messaging;
using System.Security.Authentication;
using System.Text;
using System.Threading.Tasks;
using System.Xml.Linq;
using System.Xml.Schema;
using System.IO;

namespace ConsoleApp1
{
    internal class Program
    {
        static void Main(string[] args)
        {
            ConsoleColor defaultColor = Console.ForegroundColor;
            bool BanditProtection = false;
            Random rand = new Random();
            int HowLongIsItLeftToDrive = 100;
            int maxState = 100;
            int speed = 1, energ = 100;
            double money = 0, rabish = 0;
            while (HowLongIsItLeftToDrive-- > 0 && energ > 0)
            {
                Console.WriteLine("Введите enter: ");
                healpBar(ConsoleColor.Blue, "Километров осталось: ", HowLongIsItLeftToDrive, maxState, 95, 0);
                healpBar(ConsoleColor.Green, "Энергии осталось: ", energ, maxState, 95, 2);
                healpBar(ConsoleColor.Yellow, "Монет: ", money, 95, 4);
                healpBar(ConsoleColor.DarkYellow, "Мусора: ", rabish, 95, 5);
                if (HowLongIsItLeftToDrive % 5 == 0)
                {
                    store(ref money, ref energ, ref rabish, ref speed, ref BanditProtection);
                }
                Console.ReadKey();
                int changeBandoit = rand.Next(1, 7);
                switch (changeBandoit)
                {
                    case 1:
                        banditTook(ref money, BanditProtection);
                        break;
                }
                storm(ref energ, ref rabish);
                Console.Clear();
            }


        }
        static void banditTook(ref double money, bool protectedBandit)
        {
            ConsoleColor defaultColor = Console.ForegroundColor;
            Console.WriteLine("Вы натыкаетесь на бандита!");
            if (money < 6)
            {
                money += 3;
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("У вас недостаточно денег, бандит вам сочувтсувует и даёт три монетки: ");
                Console.ForegroundColor = defaultColor;
            }
            else
            {
                money -= 6;
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("Бандит забирает у вас деньги: ");
                Console.ForegroundColor = defaultColor;
            }
            Console.ReadKey();
        }
        static void healpBar(ConsoleColor color, string massage, double number, int LeftPosition, int downPositon)
        {
            ConsoleColor defaultColor = Console.ForegroundColor;
            Console.ForegroundColor = color;
            Console.SetCursorPosition(LeftPosition, downPositon);
            Console.WriteLine(massage + number);
            Console.ForegroundColor = defaultColor;
            Console.SetCursorPosition(0, 0);
        }
        static void healpBar(ConsoleColor color, string massage, int state1, int stateMax, int LeftPosition, int downPositon)
        {
            ConsoleColor defaultColor = Console.ForegroundColor;
            Console.ForegroundColor = color;
            Console.SetCursorPosition(LeftPosition, downPositon);
            Console.WriteLine(massage + state1);
            healphbar(state1, stateMax, color, LeftPosition, downPositon + 1);
            Console.ForegroundColor = defaultColor;
            Console.SetCursorPosition(0, 0);

        }
        static void storm(ref int energ, ref double rabish)
        {
            ConsoleColor color = Console.ForegroundColor;
            Random rand = new Random();
            bool stromIsWork = true;
            while (stromIsWork)
            {
                int strom = rand.Next(0, 3);
                switch (strom)
                {
                    case 2:
                        rabish += rand.Next(0, 600);
                        stromIsWork = false;
                        break;
                    default:
                        Console.ForegroundColor = ConsoleColor.DarkYellow;
                        Console.WriteLine("Буря продолжается!");
                        energ -= 2;
                        Console.WriteLine("-2 энергии");
                        Console.ForegroundColor = color;
                        Console.ReadKey();
                        break;
                }
            }
        }
        static void healphbar(int HowKm, int HowKMall, ConsoleColor color, int CursorPositionLeft, int CursorPositionDown)
        {
            ConsoleColor defaultColor = Console.BackgroundColor;
            string bar = "";
            for (int i = 0; i < HowKm; i += 4)
            {
                bar += " ";
            }
            Console.SetCursorPosition(CursorPositionLeft, CursorPositionDown);
            Console.BackgroundColor = color;

            Console.Write(bar);
            bar = "";
            Console.BackgroundColor = defaultColor;
            for (int i = 0; i < HowKMall; i += 4)
            {
                bar += " ";
            }
            Console.Write(bar);
        }
        static int CheckingTheNumber(string massage)
        {
            int num = 0;
            while (true)
            {
                Console.WriteLine(massage);
                string input = Console.ReadLine();
                if (int.TryParse(input, out int resul))
                {
                    num = resul;
                    break;
                }
                Console.WriteLine("Вы ввели что-то нето!");
            }
            return num;
        }
        static void ConsoleWriteLine()
        {
            Console.WriteLine("1 - обменять мусор на деньги(курс 1 монета = 100 мусора)");
            Console.WriteLine("2 - купить энергии(1 энергия - 1 монета)");
            Console.WriteLine("3 - улучшить колеса");
            Console.WriteLine("4 - купить защиту от бандита");
            Console.WriteLine("5 - выход");
        }
        static void store(ref double money, ref int energ, ref double rebish, ref int speed, ref bool BanditProtection)
        {
            bool shopIsWork = true;
            Console.WriteLine("Магазин: ");
            ConsoleWriteLine();
            while (shopIsWork)
            {
                int numOperstion = CheckingTheNumber("Введите номер операции: ");
                switch (numOperstion)
                {
                    case 1:
                        if (rebish > 0)
                        {
                            money += rebish / 100.0;
                            rebish = 0;
                        }
                        Console.WriteLine($"У вас {money} монет и осталось 0 мусора");
                        break;
                    case 2:
                        int howBuyEnerg = CheckingTheNumber("Сколько вы хотите купить энергии?: ");
                        if (howBuyEnerg <= 5 || money >= howBuyEnerg)
                        {
                            money -= howBuyEnerg;
                            energ += howBuyEnerg;
                        }
                        else
                        {
                            Console.WriteLine("максимум можно купить 5 энергии!");
                        }
                        break;
                    case 3:
                        if (money - speed * 2 >= 0)
                        {
                            money -= speed * 2;
                            speed += 2;
                        }
                        else
                        {
                            Console.WriteLine("Недостаточно денег!");
                        }
                        break;
                    case 4:
                        if (!BanditProtection && money >= 15)
                        {
                            money -= 15;
                            BanditProtection = true;
                        }
                        else
                        {
                            Console.WriteLine("Защита уже куплена!");
                        }
                        break;
                    case 5:
                        Console.WriteLine("Продолжаем движение");
                        shopIsWork = false;
                        break;
                }

            }
        }
    }
}
